// Load SAR
plugin_load sar

// Speed up loading times
sar_fast_load_preset full

// Disable a weird HUD that can appear in demo playback
sar_disable_coop_score_hud 1

// Blacklist certain commands from being run in demo playback
sar_demo_blacklist 1
sar_demo_blacklist_addcmd bind
sar_demo_blacklist_addcmd quit
sar_demo_blacklist_addcmd exit
sar_demo_blacklist_addcmd sar_exit
sar_demo_blacklist_addcmd sar_on_

// Stop the game from going to sleep when it loses focus
sar_disable_no_focus_sleep 1
snd_mute_losefocus 0

// Allow OOB vision
r_portal_use_pvs_optimization 0

// SAR HUD
sar_hud_default_order_bottom text
sar_hud_default_font_index 1
sar_hud_default_padding_y 5
sar_hud_default_padding_x 5
sar_hud_default_spacing 5
sar_hud_velocity 4
sar_hud_position 2
sar_hud_angles 1
sar_hud_demo 1

// Utility functions
sar_function capt3    "svar_set output_var_tmp user_$1; svar_capture capt3_tmp $1; capt3_h1"
sar_function capt3_h1 "capt3_h2 $capt3_tmp"
sar_function capt3_h2 "svar_set $output_var_tmp $3"

sar_function restore    "svar_set restore_tmp user_$1; restore_h1 $1"
sar_function restore_h1 "$1 $restore_tmp"

sar_function mw_up_capt capt3   "bind mwheelup"
sar_function mw_up_rest restore "bind mwheelup"

// Dialogue toggle
sar_function snd_setdialogue "snd_setmixer potatosVO vol $1; snd_setmixer gladosVO vol $2; snd_setmixer announcerVO vol $2; snd_setmixer wheatleyVO vol $2; snd_setmixer caveVO vol $3; snd_setmixer coreVO vol $4"
sar_alias dialogue_off       "sar_hud_set_text 0 #FF5555Dialogue OFF; sar_alias dialogue_toggle dialogue_on;  snd_setdialogue .01 .01 .01 .01"
sar_alias dialogue_on        "sar_hud_set_text 0 #55FF55Dialogue ON;  sar_alias dialogue_toggle dialogue_off; snd_setdialogue .4  .7  .88 .75"
dialogue_on

// Fullbright toggle
sar_function ambient_rgb "mat_ambient_light_r $1; mat_ambient_light_g $1; mat_ambient_light_b $1"
sar_alias fullbright_on  "sar_alias fullbright_toggle fullbright_off; ambient_rgb .1"
sar_alias fullbright_off "sar_alias fullbright_toggle fullbright_on;  ambient_rgb 0"
fullbright_off

// Sensitivity toggle
sar_function sensitivity_reset   "sensitivity $sensitivity"
sar_function sensitivity_capture "svar_from_cvar sensitivity sensitivity"
sar_alias sensitivity_on  "sar_alias sensitivity_toggle sensitivity_off; sensitivity_capture; sensitivity .1"
sar_alias sensitivity_off "sar_alias sensitivity_toggle sensitivity_on;  sensitivity_reset"
sensitivity_capture; sensitivity_off

// Use-swap toggle
sar_alias useswap_on  "sar_alias useswap_toggle useswap_off; mw_up_capt; bind mwheelup +use"
sar_alias useswap_off "sar_alias useswap_toggle useswap_on;  mw_up_rest;"
useswap_off

// Supershoot
sar_alias +supershoot "mw_up_capt; bind mwheelup +attack"
sar_alias -supershoot "mw_up_rest"
-supershoot

// Toast settings
sar_toast_setpos bottom left
sar_toast_width 500

// Category switching aliases
sar_alias fullgame "svar_set category fullgame; exec cats/fullgame"
sar_alias anypc    "svar_set category anypc;    exec cats/anypc"
sar_alias sp_cm    "svar_set category sp_cm;    exec cats/sp_cm"
sar_alias amc      "svar_set category amc;      exec cats/amc"
sar_alias ac       "svar_set category ac;       exec cats/ac"
sar_alias coop_cm  "svar_set category coop_cm;  exec cats/coop_cm"

// Automatically detect categories where possible
sar_on_load cond "!var:no_auto_category=1 & !var:category=anypc & !var:category=ac & !var:category=fullgame & !cm & !coop" fullgame
sar_on_load cond "!var:no_auto_category=1 & !var:category=anypc & !var:category=ac & !var:category=sp_cm    &  cm & !coop" sp_cm
sar_on_load cond "!var:no_auto_category=1 & !var:category=anypc & !var:category=ac & !var:category=amc      & !cm &  coop" amc
sar_on_load cond "!var:no_auto_category=1 & !var:category=anypc & !var:category=ac & !var:category=coop_cm  &  cm &  coop" coop_cm

// Dialogue fade toasts
sar_toast_tag_set_duration fade forever
sar_on_load sar_toast_tag_dismiss_all fade
sar_on_load cond "!var:no_dialogue_toasts=1 & (var:category=amc | var:category=ac)" exec dialogue_toasts/coop
sar_on_load cond "!var:no_dialogue_toasts=1 & var:category=fullgame"                exec dialogue_toasts/sp

// Add the mtrigger categories and the sar_on_load execs
// We do this *after* running the category exec, so that no_mtriggers is set if
// necessary
exec mtriggers/mtriggers
